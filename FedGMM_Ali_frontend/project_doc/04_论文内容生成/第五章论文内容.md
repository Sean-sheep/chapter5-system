# 第五章 系统设计与实现

## 5.1 系统总体架构设计

### 5.1.1 系统概述

本章设计并实现了一个城市旅游消费个性化推荐系统展示平台，该系统旨在展示已完成训练的个性化联邦学习模型的成果。系统不参与模型训练过程，不修改训练代码，不实现算法逻辑，仅负责读取训练输出结果并进行可视化展示。该系统能够有效展示个性化联邦学习在推荐场景下的应用效果，包括个性化推荐效果、通信压缩效果、自适应本地迭代轨迹以及客户端异质性分析等关键指标。

系统采用分层架构设计，将功能划分为模型结果层、业务场景模拟层、可视化分析层和前端展示层四个层次，各层职责明确，通过接口进行交互，实现松耦合、高内聚的设计。

### 5.1.2 系统架构设计

**（1）模型结果层**  
负责从文件系统读取训练输出，支持 JSON、PKL、NPY、CSV 等格式，加载全局子模型、客户端混合权重 γ、通信统计、τ* 轨迹及评估指标，提供统一数据访问接口。

**（2）业务场景模拟层**  
负责模拟城市旅游消费推荐场景，将城市与客户端 ID 映射，提供推荐推理接口，通过组合子模型与 γ 生成个性化模型并执行前向推理，不涉及训练。

**（3）可视化分析层**  
负责生成通信压缩比例曲线、τ* 变化曲线、γ 分布图、推荐差异对比图等，为前端提供可视化数据。

**（4）前端展示层**  
采用 Streamlit 实现，提供城市选择、用户 ID 输入、推荐结果展示、指标与图表展示、实验对比等功能，界面简洁，适合论文展示。

### 5.1.3 技术选型

系统采用 Python 作为主要开发语言，前端使用 Streamlit，数据处理使用 pandas 与 numpy，模型加载使用 pickle 与 joblib，可视化使用 matplotlib 与 plotly，训练结果存于本地文件系统，无需数据库。

---

## 5.2 功能模块设计

系统包含五个核心功能模块。

**（1）模型加载器**  
从指定目录加载训练结果，支持多格式；提供加载子模型、客户端模型、混合权重 γ 及组合个性化模型的接口；具备缓存与错误处理。

**（2）推荐推理接口**  
维护城市与客户端 ID 映射；根据城市与用户 ID 加载个性化模型并执行前向推理，返回 Top-K 推荐列表；支持多城市推荐对比与结果格式化。

**（3）通信分析模块**  
读取通信统计数据，计算每轮或平均压缩比例，生成压缩曲线数据与通信统计报告，用于展示通信压缩效果。

**（4）自适应迭代次数展示模块**  
读取 τ* 轨迹，生成 τ* 随轮次与客户端的变化曲线，分析自适应策略效果（如平均迭代次数、调整频率等）。

**（5）个性化权重分析模块**  
加载并展示所有客户端的 γ，生成权重分布与对比表，支持按轮次、客户端分析权重趋势及城市间权重差异。

---

## 5.3 系统实现细节

### 5.3.1 数据格式设计

训练结果需按约定目录与命名存放：模型参数（PKL）、权重（JSON）、通信统计（JSON）、τ* 轨迹（JSON/CSV）、评估指标（JSON）等，便于系统统一读取。

### 5.3.2 推荐推理实现

根据城市获取客户端 ID，加载该客户端的个性化模型（或由子模型与 γ 组合），按模型类型执行前向推理，对所有物品评分排序后取 Top-K 作为推荐结果。

### 5.3.3 可视化与前端

使用 matplotlib、plotly 绘制压缩比例曲线、τ* 轨迹、γ 分布及推荐对比图；前端使用 Streamlit 实现推荐页、通信分析页、自适应迭代页、权重分析页及综合对比页，支持参数选择与数据导出。

---

## 5.4 系统运行示例

### 5.4.1 系统启动

```bash
pip install streamlit pandas numpy matplotlib plotly
streamlit run app.py
```

用户通过浏览器访问系统后，可从首页进入「训练过程展示」或「用户推荐使用」两大区域。

### 5.4.2 推荐功能示例

用户选择城市（如 Tokyo）、输入用户 ID、设置 Top-K 后点击生成推荐；系统加载对应客户端个性化模型并前向推理，展示 Top-K 推荐列表（商品 ID、名称、预测评分）。

### 5.4.3 训练过程展示示例

在通信压缩页查看压缩比例随轮次曲线与统计表；在自适应迭代页查看 τ* 随轮次与客户端的变化曲线；在权重分析页查看 γ 分布与变化趋势，从而体现第三章、第四章的算法创新。

---

## 5.5 本章小结

本章设计并实现了城市旅游消费个性化推荐系统展示平台，采用四层架构与五个核心功能模块，完成从训练结果读取、推理到可视化展示的完整流程。系统不参与训练，仅基于训练日志与已训练模型进行展示，有效体现了个性化联邦学习、通信压缩与自适应本地迭代等创新点的效果，为论文算法部分提供了系统化展示与验证支撑。
