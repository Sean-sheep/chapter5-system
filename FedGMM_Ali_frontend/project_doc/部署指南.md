# 部署指南

## 1. 文档目的

本文档旨在详细说明城市旅游消费个性化推荐系统的部署步骤、环境配置、依赖安装等内容，帮助系统管理员和开发人员快速部署和运行系统。

## 2. 适用范围

本文档适用于城市旅游消费个性化推荐系统的部署和运维人员，包括系统管理员、开发人员和测试人员。

## 3. 系统架构

### 3.1 架构概述

系统采用前后端分离的架构设计，后端使用Flask框架实现API接口，前端使用HTML、CSS和JavaScript实现页面布局和交互逻辑。

### 3.2 技术栈

| 层级 | 技术 | 版本 | 用途 |
|------|------|------|------|
| 后端 | Python | 3.8+ | 实现API接口和业务逻辑 |
| 后端 | Flask | 2.0+ | Web框架，提供API接口 |
| 后端 | Flask-CORS | 3.0+ | 处理跨域请求 |
| 前端 | HTML5 | - | 页面结构 |
| 前端 | CSS3 | - | 页面样式 |
| 前端 | JavaScript | ES6+ | 交互逻辑 |
| 前端 | Chart.js | 3.0+ | 数据可视化 |

## 4. 环境要求

### 4.1 硬件要求

| 硬件 | 要求 | 用途 |
|------|------|------|
| CPU | 至少2核 | 运行后端服务和前端页面 |
| 内存 | 至少4GB | 存储模型数据和运行服务 |
| 存储 | 至少500MB | 存储代码、依赖和数据文件 |

### 4.2 软件要求

| 软件 | 版本 | 用途 |
|------|------|------|
| 操作系统 | Windows 10+ / Linux / macOS | 运行环境 |
| Python | 3.8+ | 运行后端服务 |
| 浏览器 | Chrome 80+ / Firefox 75+ / Safari 13+ / Edge 80+ | 访问前端页面 |

## 5. 部署步骤

### 5.1 环境准备

#### 5.1.1 Python环境安装

1. **Windows系统**：
   - 访问 [Python官网](https://www.python.org/downloads/)，下载Python 3.8+版本
   - 运行安装程序，勾选「Add Python to PATH」选项
   - 点击「Install Now」完成安装
   - 验证安装：打开命令提示符，输入 `python --version`，显示Python版本信息

2. **Linux系统**：
   - 使用包管理器安装Python 3.8+：
     ```bash
     # Ubuntu/Debian
     sudo apt update
     sudo apt install python3.8 python3-pip
     
     # CentOS/RHEL
     sudo yum update
     sudo yum install python3.8 python3-pip
     ```
   - 验证安装：输入 `python3 --version`，显示Python版本信息

3. **macOS系统**：
   - 使用Homebrew安装Python 3.8+：
     ```bash
     brew update
     brew install python
     ```
   - 验证安装：输入 `python3 --version`，显示Python版本信息

#### 5.1.2 虚拟环境创建

根据项目文件规范与管理规约，系统必须在独立的Python虚拟环境中运行，虚拟环境目录必须位于项目根目录下，使用 `venv` 作为虚拟环境目录名。

1. **Windows系统**：
   ```bash
   # 进入项目根目录
   cd FedGMM_Ali_frontend
   
   # 创建虚拟环境
   python -m venv venv
   
   # 激活虚拟环境
   venv\Scripts\activate
   ```

2. **Linux/macOS系统**：
   ```bash
   # 进入项目根目录
   cd FedGMM_Ali_frontend
   
   # 创建虚拟环境
   python3 -m venv venv
   
   # 激活虚拟环境
   source venv/bin/activate
   ```

### 5.2 依赖安装

#### 5.2.1 后端依赖安装

1. **激活虚拟环境**（如果未激活）：
   - Windows：`venv\Scripts\activate`
   - Linux/macOS：`source venv/bin/activate`

2. **安装依赖**：
   ```bash
   # 安装后端依赖
   pip install -r backend/requirements.txt
   ```

#### 5.2.2 前端依赖安装

前端无需特殊依赖安装，直接在浏览器中打开 `frontend/index.html` 即可。

### 5.3 数据准备

确保数据文件已正确放置在 `data/` 目录下，包括：

- **通信数据**：`data/communication/` 目录
- **γ权重数据**：`data/gamma/` 目录
- **τ*数据**：`data/tau/` 目录
- **模型数据**：`data/models/` 目录

### 5.4 后端服务启动

1. **激活虚拟环境**（如果未激活）：
   - Windows：`venv\Scripts\activate`
   - Linux/macOS：`source venv/bin/activate`

2. **启动后端服务**：
   ```bash
   # 进入后端目录
   cd backend
   
   # 启动服务
   python app.py
   ```

3. **验证后端服务**：
   - 打开浏览器，访问 `http://localhost:5000/api/system/status`
   - 预期响应：
     ```json
     {
       "data_loaded": true,
       "available_cities": ["Tokyo", "Osaka", "Nagoya"],
       "available_rounds": [0, 1, 2, ..., 50],
       "system_status": "系统正常运行，所有数据已加载",
       "data_status": {
         "communication": true,
         "gamma": true,
         "tau": true,
         "models": true
       }
     }
     ```

### 5.5 前端页面访问

1. **打开前端页面**：
   - 在浏览器中打开 `frontend/index.html` 文件
   - 或使用本地服务器访问：
     ```bash
     # 进入前端目录
     cd frontend
     
     # 使用Python内置服务器（可选）
     python -m http.server 8000
     # 然后访问 http://localhost:8000
     ```

2. **验证前端页面**：
   - 查看系统状态，确认系统是否正常运行
   - 尝试进入各个功能页面，验证功能是否正常

## 6. 部署模式

### 6.1 开发环境部署

**适用场景**：开发人员进行代码开发和测试

**部署步骤**：
1. 克隆代码仓库到本地
2. 创建并激活虚拟环境
3. 安装后端依赖
4. 启动后端服务（使用开发模式）
5. 在浏览器中打开前端页面进行测试

### 6.2 测试环境部署

**适用场景**：测试人员进行功能测试和性能测试

**部署步骤**：
1. 克隆代码仓库到测试服务器
2. 创建并激活虚拟环境
3. 安装后端依赖
4. 启动后端服务
5. 在浏览器中打开前端页面进行测试

### 6.3 生产环境部署

**适用场景**：系统正式上线运行

**部署步骤**：
1. 克隆代码仓库到生产服务器
2. 创建并激活虚拟环境
3. 安装后端依赖
4. 配置生产环境参数（如端口、IP地址等）
5. 使用WSGI服务器（如Gunicorn）运行后端服务
6. 配置前端页面的静态文件服务器
7. 配置域名和SSL证书（可选）

## 7. 常见部署问题与解决方案

### 7.1 依赖安装问题

**问题**：安装依赖时提示权限不足

**解决方案**：
- Windows：以管理员身份运行命令提示符
- Linux/macOS：使用 `sudo` 命令或以root用户身份运行

**问题**：安装依赖时提示版本冲突

**解决方案**：
- 确保使用虚拟环境隔离依赖
- 尝试更新pip版本：`pip install --upgrade pip`
- 重新创建虚拟环境并安装依赖

### 7.2 后端服务启动问题

**问题**：后端服务启动失败，提示缺少依赖模块

**解决方案**：
- 确保已激活虚拟环境
- 确保已安装所有必要的依赖模块：`pip install -r backend/requirements.txt`

**问题**：后端服务启动失败，提示端口被占用

**解决方案**：
- 检查端口5000是否被其他进程占用
- 修改 `app.py` 文件中的端口配置：
  ```python
  if __name__ == '__main__':
      app.run(debug=True, port=8080)  # 修改端口为8080
  ```

### 7.3 前端页面访问问题

**问题**：前端页面无法访问后端API

**解决方案**：
- 确保后端服务已启动
- 检查浏览器控制台是否有跨域错误
- 确保后端服务的CORS配置正确

**问题**：前端页面加载缓慢或卡顿

**解决方案**：
- 确保浏览器版本符合要求
- 清除浏览器缓存
- 检查网络连接是否稳定

### 7.4 数据加载问题

**问题**：系统状态显示「系统运行中，缺少数据」

**解决方案**：
- 确保数据文件已正确放置在 `data/` 目录下
- 检查数据文件格式是否正确
- 检查数据文件权限是否正确

## 8. 系统监控与维护

### 8.1 系统监控

- **后端服务监控**：使用进程监控工具（如Supervisor）监控后端服务的运行状态
- **日志监控**：查看后端服务的日志文件，及时发现和解决问题
- **性能监控**：监控系统的响应时间、内存使用和CPU使用率

### 8.2 系统维护

- **定期备份**：定期备份数据文件和配置文件
- **依赖更新**：定期更新系统依赖，确保安全性和稳定性
- **代码更新**：按照版本控制流程更新系统代码
- **问题排查**：及时排查和解决系统运行中出现的问题

## 9. 版本历史

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| v1.0 | 2026-02-18 | 初始版本，详细说明系统的部署步骤、环境配置、依赖安装等内容 | 系统生成 |
